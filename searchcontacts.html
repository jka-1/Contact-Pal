<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Search Contacts</title>
  <style>
    /* (same styles as before, plus delete button tweaks) */
    :root {
      --bg: #0b1220;
      --card: rgba(255,255,255,0.04);
      --card-border: rgba(255,255,255,0.10);
      --text: #e5e7eb;
      --muted: #94a3b8;
      --accent1: #3b82f6;
      --accent2: #2563eb;
      --danger: #ef4444;
      --row: rgba(255,255,255,0.03);
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background: var(--bg); color: var(--text); line-height: 1.45; }
    .container { max-width: 980px; margin: 0 auto; padding: 24px; }
    .page-title { font-size: 20px; font-weight: 600; margin: 8px 0 24px; color: #fff; }
    .card { background: var(--card); border: 1px solid var(--card-border); border-radius: 16px; padding: 20px; box-shadow: 0 10px 40px -10px rgba(0,0,0,.65); }
    .label { font-size: 12px; color: var(--muted); margin-bottom: 6px; display: block; }
    .input, .button, .endpoint {
      width: 100%; border-radius: 12px; border: 1px solid var(--card-border);
      background: rgba(255,255,255,0.06); color: var(--text); padding: 10px 12px; outline: none;
    }
    .button {
      cursor: pointer; background: linear-gradient(to bottom, var(--accent1), var(--accent2));
      border: none; font-weight: 600; box-shadow: 0 10px 20px -6px rgba(37,99,235,.55);
    }
    .delete-btn {
      background: var(--danger);
      border: none;
      color: #fff;
      padding: 6px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
    }
    .delete-btn:hover { opacity: 0.9; }
    th, td { padding: 12px 14px; text-align: left; border-bottom: 1px solid rgba(255,255,255,.06); }
    tbody tr:hover { background: var(--row); }
    .logout-btn { position: absolute; top: 16px; right: 20px; background: linear-gradient(to bottom, var(--accent1), var(--accent2)); color: #fff; border: none; padding: 8px 14px; border-radius: 8px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px -4px rgba(37,99,235,.55); }
  </style>
</head>
<body>
  <div class="container">
    <button id="logoutBtn" class="logout-btn">Logout</button>
    <h1 class="page-title">Search Contacts</h1>
    <div class="card">
      <div class="row">
        <div>
          <label class="label" for="q">Search</label>
          <input id="q" class="input" placeholder="e.g., Team, 555, @gmail.com" />
        </div>
        <div>
          <label class="label" for="uid">User ID</label>
          <input id="uid" class="input" value="1" type="number" inputmode="numeric" />
        </div>
        <div style="display:flex; align-items:flex-end;">
          <button id="go" class="button">Search</button>
        </div>
      </div>

      <div id="error" class="error" style="display:none;"></div>

      <div class="table-wrap" id="resultsWrap">
        <div id="loading" style="display:none;">
          <div class="shimmer-row"></div>
          <div class="shimmer-row"></div>
          <div class="shimmer-row"></div>
        </div>
        <div id="empty" class="empty">No results yet. Try a search.</div>
        <table id="results" style="display:none;">
          <thead>
            <tr>
              <th>Name</th><th>Phone</th><th>Email</th><th>ID</th><th>Action</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
    <input type="hidden" id="endpoint" value="http://129.212.179.109/LAMPAPI/SearchContact.php">
    <input type="hidden" id="deleteEndpoint" value="http://129.212.179.109/LAMPAPI/DeleteContact.php">
  </div>

<script>
  const qEl = document.getElementById('q');
  const uidEl = document.getElementById('uid');
  const goEl = document.getElementById('go');
  const endpointEl = document.getElementById('endpoint');
  const deleteEndpointEl = document.getElementById('deleteEndpoint');
  const errorEl = document.getElementById('error');
  const loadingEl = document.getElementById('loading');
  const emptyEl = document.getElementById('empty');
  const tableEl = document.getElementById('results');
  const tbodyEl = tableEl.querySelector('tbody');

  function setState({loading=false, error='', rows=null}) {
    goEl.disabled = loading;
    errorEl.style.display = error ? 'block' : 'none';
    errorEl.textContent = error || '';
    loadingEl.style.display = loading ? 'block' : 'none';
    if (rows === null) return;

    tbodyEl.innerHTML = '';
    if (!rows || rows.length === 0) {
      tableEl.style.display = 'none';
      emptyEl.style.display = 'block';
    } else {
      emptyEl.style.display = 'none';
      tableEl.style.display = 'table';
      for (const r of rows) {
        const tr = document.createElement('tr');
        const name = `${r.firstName || ''} ${r.lastName || ''}`.trim();
        tr.innerHTML = `
          <td><strong>${escapeHtml(name || '—')}</strong></td>
          <td class="muted">${escapeHtml(r.phone || '—')}</td>
          <td class="muted">${escapeHtml(r.email || '—')}</td>
          <td><span class="badge">#${escapeHtml(r.id)}</span></td>
          <td><button class="delete-btn" data-id="${r.id}">Delete</button></td>
        `;
        tbodyEl.appendChild(tr);
      }
      tbodyEl.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', () => deleteContact(btn.dataset.id));
      });
    }
  }

  function escapeHtml(s) {
    return String(s).replace(/[&<>'"]/g, c => ({
      '&': '&amp;', '<': '&lt;', '>': '&gt;', "'": '&#39;', '"': '&quot;'
    }[c]));
  }

  async function runSearch() {
    setState({loading:true, error:'', rows:null});
    try {
      const endpoint = endpointEl.value.trim();
      const uid = String(uidEl.value || '').trim();
      if (!uid) throw new Error('Enter a User ID.');

      const body = { search: (qEl.value || '').trim(), userId: uid };
      const res = await fetch(endpoint, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();
      if (data && Array.isArray(data.results)) {
        setState({ loading:false, error:'', rows: data.results });
      } else {
        throw new Error(data.error || 'Unexpected response');
      }
    } catch (e) {
      setState({loading:false, error: e.message || String(e), rows: []});
    }
  }

async function deleteContact(id) {
  if (!confirm('Are you sure you want to delete this contact?')) return;

  const endpoint = deleteEndpointEl.value.trim();
  const idNum = Number(id);
  const userIdNum = Number(uidEl.value);

  try {
    if (!Number.isInteger(idNum)) throw new Error('Invalid contact id');
    if (!Number.isInteger(userIdNum)) throw new Error('Invalid user id');

    const res = await fetch(endpoint, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      // Try the most likely schema: ID + UserID as integers
      body: JSON.stringify({ contactId: idNum, userId: userIdNum })
    });

    const text = await res.text();
    let data;
    try { data = JSON.parse(text); } catch { data = { raw: text }; }

    if (!res.ok) {
      throw new Error(`HTTP ${res.status}${data?.error ? ` - ${data.error}` : ''}`);
    }
    if (data?.error) {
      throw new Error(data.error);
    }

    alert('Contact deleted.');
    runSearch();
  } catch (e) {
    console.error(e);
    alert('Delete failed: ' + (e?.message || e));
  }
}

  goEl.addEventListener('click', runSearch);
  qEl.addEventListener('keydown', (e) => { if (e.key === 'Enter') runSearch(); });
  uidEl.addEventListener('keydown', (e) => { if (e.key === 'Enter') runSearch(); });
  document.getElementById('logoutBtn').addEventListener('click', () => {window.location.href = 'index.html';});
</script>
</body>
</html>
